---
import { siteConfig } from '../config/site';

const currentPath = Astro.url.pathname;

const nav = [
  { label: 'ABOUT',     href: '/#about' },
  { label: 'SERVICE',   href: '/#service' },
  { label: 'COMMUNITY', href: '/#community' },
  { label: 'JOIN',      href: '/#join' },
];
---

<header class="nav" id="nav">
  <div class="nav__inner">
    <a href="/" class="nav__logo">FLAGSHIP</a>

    <nav class="nav__links" aria-label="メインナビゲーション">
      {nav.map(link => (
        <a href={link.href} class="nav__link">{link.label}</a>
      ))}
    </nav>

    <a href="/#join" class="btn btn--outline nav__cta">JOIN FREE</a>

    <button class="nav__burger" id="navBurger" aria-label="メニューを開く" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</header>

<!-- Mobile overlay -->
<div class="nav__overlay" id="navOverlay" aria-hidden="true">
  <nav class="nav__mobile">
    {nav.map(link => (
      <a href={link.href} class="nav__mobile-link">{link.label}</a>
    ))}
    <a href="/#join" class="btn btn--primary" style="margin-top:2rem;align-self:center;">
      JOIN FREE →
    </a>
  </nav>
</div>

<style>
  /* ── NAVBAR ────────────────────────────── */
  .nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--nav-h);
    z-index: 200;
    background: rgba(5,5,5,0.88);
    border-bottom: 1px solid rgba(0,240,255,0.12);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    transition: background 0.3s;
  }

  .nav__inner {
    display: flex;
    align-items: center;
    height: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 48px;
    gap: 2.5rem;
  }

  /* Logo */
  .nav__logo {
    font-family: 'Inter', sans-serif;
    font-weight: 900;
    font-size: 1.3rem;
    color: #fff;
    letter-spacing: -0.02em;
    margin-right: auto;
    text-decoration: none;
    transition: color 0.3s;
  }
  .nav__logo:hover { color: var(--accent); }

  /* Links */
  .nav__links {
    display: flex;
    gap: 2.5rem;
  }

  .nav__link {
    font-family: 'Inter', sans-serif;
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 0.18em;
    color: var(--text-dim);
    text-decoration: none;
    position: relative;
    transition: color 0.3s;
  }
  .nav__link::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--accent);
    transition: width 0.3s var(--ease);
  }
  .nav__link:hover { color: var(--accent); }
  .nav__link:hover::after { width: 100%; }

  /* CTA */
  .nav__cta {
    font-size: 0.65rem;
    padding: 9px 22px;
    flex-shrink: 0;
  }

  /* Burger */
  .nav__burger {
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 6px;
    width: 36px;
  }
  .nav__burger span {
    display: block;
    width: 22px;
    height: 1.5px;
    background: var(--text);
    transition: all 0.3s var(--ease);
    transform-origin: center;
  }
  .nav__burger.is-open span:nth-child(1) { transform: translateY(6.5px) rotate(45deg); }
  .nav__burger.is-open span:nth-child(2) { opacity: 0; }
  .nav__burger.is-open span:nth-child(3) { transform: translateY(-6.5px) rotate(-45deg); }

  /* ── MOBILE OVERLAY ─────────────────────── */
  .nav__overlay {
    display: none;
    position: fixed;
    inset: 0;
    top: var(--nav-h);
    background: rgba(5,5,5,0.97);
    z-index: 199;
    overflow-y: auto;
  }
  .nav__overlay.is-open { display: flex; }

  .nav__mobile {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding: 3rem 24px;
    gap: 1.2rem;
    width: 100%;
  }

  .nav__mobile-link {
    font-family: 'Inter', sans-serif;
    font-weight: 900;
    font-size: 2rem;
    letter-spacing: 0.05em;
    color: var(--text-dim);
    text-decoration: none;
    transition: color 0.3s;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    padding-bottom: 1rem;
    width: 100%;
  }
  .nav__mobile-link:hover { color: var(--accent); }

  @media (max-width: 900px) {
    .nav__links, .nav__cta { display: none; }
    .nav__burger { display: flex; }
    .nav__inner { padding: 0 24px; }
  }
</style>

<script>
  const burger  = document.getElementById('navBurger');
  const overlay = document.getElementById('navOverlay');

  burger?.addEventListener('click', () => {
    const open = overlay?.classList.toggle('is-open');
    burger.classList.toggle('is-open');
    burger.setAttribute('aria-expanded', String(open));
    overlay?.setAttribute('aria-hidden', String(!open));
    document.body.style.overflow = open ? 'hidden' : '';
  });

  // close on link click
  overlay?.querySelectorAll('a').forEach(a => {
    a.addEventListener('click', () => {
      overlay.classList.remove('is-open');
      burger?.classList.remove('is-open');
      burger?.setAttribute('aria-expanded', 'false');
      overlay.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    });
  });
</script>
