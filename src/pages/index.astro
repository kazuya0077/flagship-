---
import BaseLayout from '../layouts/BaseLayout.astro';
import AspLink from '../components/AspLink.astro';

// Bento Grid Items
const features = [
  {
    title: "質問し放題",
    desc: "24時間365日、いつでもSlackで質問可能。高得点合格者が丁寧に回答します。",
    colSpan: 2,
    rowSpan: 2,
    image: "/assets/images/feature-slack.jpg",
    color: "#E3F2FD", // Imageがない場合の背景
    icon: "message-circle" 
  },
  {
    title: "学習資産へのアクセス",
    desc: "合格者のノウハウが詰まった分析シートやまとめノートを自由にDL。",
    colSpan: 1,
    rowSpan: 1,
    image: "/assets/images/feature-resources.jpg",
    color: "#FFF3E0",
    icon: "folder"
  },
  {
    title: "月額500円",
    desc: "参考書1冊より安い価格で、最高の学習環境を。",
    colSpan: 1,
    rowSpan: 1,
    image: null,
    color: "#E8F5E9",
    icon: "credit-card"
  },
  {
    title: "仲間との繋がり",
    desc: "同じ目標を持つ仲間と励まし合い、モチベーションを維持。",
    colSpan: 1,
    rowSpan: 1,
    image: "/assets/images/feature-community.jpg",
    color: "#FCE4EC",
    icon: "users"
  },
  {
    title: "オンライン勉強会",
    desc: "月2回の勉強会や相談会で、直接アドバイスを受けられます。",
    colSpan: 1,
    rowSpan: 1,
    image: null,
    color: "#F3E5F5",
    icon: "video"
  }
];

// Stats
const stats = [
  { label: "講師国試得点", value: "238", unit: "点" },
  { label: "学習資料数", value: "500", unit: "+" },
  { label: "回答時間", value: "24", unit: "h以内" },
  { label: "継続率", value: "98", unit: "%" },
];

import { recommendItems } from '../data/items';
---

<BaseLayout 
  title="フラッグシップ"
  description="自走する力を育む、理学療法士国家試験対策の学習コミュニティ。"
>
  <!-- Opening Animation -->
  <div class="opening-overlay">
    <div class="opening-logo">
      <span class="logo-text">Flagship</span>
      <span class="logo-sub">PT National Exam Community</span>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero__bg-slider">
      <div class="hero__slide active img-placeholder" style="background-image: url('/assets/images/hero-1.jpg');"></div>
      <div class="hero__slide img-placeholder" style="background-image: url('/assets/images/hero-2.jpg');"></div>
      <div class="hero__slide img-placeholder" style="background-image: url('/assets/images/hero-3.jpg');"></div>
    </div>
    
    <div class="hero__overlay"></div>
    
    <div class="container hero__container">
      <div class="hero__content scroll-fade-up">
        <span class="hero__tag">PT国試コミュニティ</span>
        <h1 class="hero__title">
          自走する力を、<br>
          <span class="text-primary">ここ</span>から。
        </h1>
        <p class="hero__lead">
          一人で悩まない。仲間と共に、<br class="sp-only">
          最短距離で合格を勝ち取る場所。
        </p>
        <div class="hero__actions">
          <a href="/join" class="btn btn--primary">
            今すぐ参加する
          </a>
          <a href="#about" class="btn btn--secondary">
            詳しく見る
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="section">
    <div class="container container--narrow text-center">
      <span class="section-label">CONCEPT</span>
      <h2 class="section-title scroll-fade-up">なぜ、「フラッグシップ」なのか。</h2>
      <p class="scroll-fade-up delay-1">
        ただ知識を詰め込むだけの予備校ではありません。<br>
        「なぜ？」を問い、自ら考え、解決する力を養う。<br>
        それは、国試合格だけでなく、<br>
        その先の臨床でも通用する「プロフェッショナルの土台」を作るためです。
      </p>
    </div>
  </section>

  <!-- Features (PC: Bento Grid / SP: Carousel) -->
  <section class="section section--bg">
    <div class="container">
      <span class="section-label">FEATURES</span>
      <h2 class="section-title scroll-fade-up">学習を加速させる環境</h2>

      <!-- PC Layout -->
      <div class="bento-grid pc-only">
        {features.map(item => (
          <div class={`bento-item col-span-${item.colSpan} row-span-${item.rowSpan} scroll-fade-up`}>
            {item.image ? (
              <div class="bento-visual">
                <img src={item.image} alt={item.title} loading="lazy" onError="this.style.display='none'; this.parentElement.classList.add('img-placeholder')" />
              </div>
            ) : (
              <div class="bento-bg" style={`background-color: ${item.color}`}></div>
            )}
            <div class="bento-content">
              <h3 class="bento-title">{item.title}</h3>
              <p class="bento-desc">{item.desc}</p>
            </div>
          </div>
        ))}
      </div>

      <!-- SP Layout -->
      <div class="carousel-stack sp-only">
        {features.map(item => (
          <div class="carousel-item scroll-fade-up">
            <div class="carousel-visual img-placeholder">
              {item.image && <img src={item.image} alt={item.title} loading="lazy" onError="this.style.display='none'" />}
            </div>
            <h3 class="bento-title mt-4">{item.title}</h3>
            <p class="bento-desc">{item.desc}</p>
          </div>
        ))}
        <!-- Swipe Hint -->
        <div class="carousel-hint">Swipe &rarr;</div>
      </div>

    </div>
  </section>

  <!-- Stats -->
  <section class="section">
    <div class="container">
      <div class="stats-grid">
        {stats.map(stat => (
          <div class="stat-item scroll-fade-up">
            <div class="stat-value">{stat.value}<span class="stat-unit">{stat.unit}</span></div>
            <div class="stat-label">{stat.label}</div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- ASP Links -->
  <section class="section section--bg">
    <div class="container">
      <span class="section-label">RECOMMEND</span>
      <h2 class="section-title scroll-fade-up">推奨教材</h2>
      
      <div class="asp-grid">
        {recommendItems.map(item => (
          <AspLink 
            title={item.title}
            description={item.description}
            links={item.links}
            image={item.image}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta-section">
    <div class="container text-center">
      <h2 class="cta-title scroll-fade-up">未来を変える準備は<br>できましたか？</h2>
      <p class="cta-text scroll-fade-up delay-1">
        月額500円。リスクはありません。<br>
        あなたの挑戦を、全力でサポートします。
      </p>
      <a href="/join" class="btn btn--secondary btn--lg scroll-fade-up delay-2">
        メンバーシップに参加する
      </a>
    </div>
  </section>

</BaseLayout>

<style>
  /* Hero */
  .hero {
    height: 90vh;
    min-height: 600px;
    position: relative;
    display: flex;
    align-items: center;
    overflow: hidden;
  }
  
  .hero__bg-slider, .hero__slide {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
  }
  
  .hero__slide {
    background-size: cover;
    background-position: center;
    opacity: 0;
    transition: opacity 2s ease;
  }
  
  .hero__slide.active { opacity: 1; }
  
  .hero__overlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: linear-gradient(to right, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.6) 50%, rgba(255,255,255,0.2) 100%);
    z-index: 1;
  }
  
  .hero__container {
    position: relative;
    z-index: 2;
  }
  
  .hero__content { max-width: 600px; }
  
  .hero__tag {
    display: inline-block;
    padding: 6px 12px;
    background: var(--text);
    color: white;
    font-size: 0.8rem;
    font-weight: 700;
    margin-bottom: 24px;
    border-radius: 4px;
  }
  
  .hero__title {
    font-size: 3rem;
    line-height: 1.2;
    margin-bottom: 24px;
  }
  
  .hero__lead {
    font-size: 1.1rem;
    margin-bottom: 40px;
  }
  
  .hero__actions {
    display: flex;
    gap: 16px;
  }
  
  /* Stats */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
  }
  
  .stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
    font-family: 'Inter', sans-serif;
  }
  
  .stat-unit { font-size: 1rem; color: var(--text); margin-left: 4px; }
  .stat-label { font-size: 0.9rem; color: var(--text-light); }
  
  @media(min-width: 768px) {
    .stats-grid { grid-template-columns: repeat(4, 1fr); }
    .hero__title { font-size: 4.5rem; }
  }

  /* CTA */
  .cta-section {
    background: var(--primary);
    color: white;
    padding: 120px 0;
  }
  
  .cta-title { color: white; margin-bottom: 24px; }
  .cta-text { color: rgba(255,255,255,0.9); margin-bottom: 40px; }
  
  /* Opening & Others */
  .opening-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: white;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeOut 0.5s ease 1.5s forwards;
    pointer-events: none;
  }
  
  .opening-logo { font-size: 2rem; font-weight: 700; color: var(--primary); opacity: 0; animation: fadeInOut 1.5s ease forwards; text-align: center; }
  .logo-sub { display: block; font-size: 0.8rem; color: var(--text-light); font-weight: 400; margin-top: 8px; }
  
  @keyframes fadeInOut {
    0% { opacity: 0; transform: translateY(10px); }
    20% { opacity: 1; transform: translateY(0); }
    80% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-10px); }
  }
  @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }

  .text-primary { color: var(--primary); }
  .mt-4 { margin-top: 1rem; }
  .section--bg { background: var(--bg-panel); }
  
  /* SP Carousel */
  .carousel-visual {
    height: 180px;
    background: #EEE;
    border-radius: var(--radius-md);
    margin-bottom: 16px;
    overflow: hidden;
  }
  
  .carousel-visual img { width: 100%; height: 100%; object-fit: cover; }
  
  .asp-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
    max-width: 900px;
    margin: 0 auto;
  }
  
  @media (min-width: 768px) {
    .asp-grid { grid-template-columns: 1fr 1fr; }
  }
  
  .bento-bg {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: 0;
    opacity: 0.5;
  }
</style>

<script>
  // Simple Slider
  const slides = document.querySelectorAll('.hero__slide');
  let current = 0;
  if(slides.length > 0) {
    setInterval(() => {
      slides[current].classList.remove('active');
      current = (current + 1) % slides.length;
      slides[current].classList.add('active');
    }, 5000);
  }

  // Scroll Observer
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if(entry.isIntersecting) entry.target.classList.add('visible');
    });
  }, { threshold: 0.1 });
  
  document.querySelectorAll('.scroll-fade-up').forEach(el => observer.observe(el));
</script>
