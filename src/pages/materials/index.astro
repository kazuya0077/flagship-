---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allMaterials = await getCollection('materials');

// ã‚«ãƒ†ã‚´ãƒªã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
const categories = [
  { id: 'kokushi', name: 'å›½è©¦ç·åˆ', icon: 'ğŸ“–' },
  { id: 'anatomy', name: 'è§£å‰–å­¦', icon: 'ğŸ¦´' },
  { id: 'kinesiology', name: 'é‹å‹•å­¦', icon: 'ğŸƒ' },
  { id: 'internal', name: 'å†…ç§‘ç³»', icon: 'ğŸ«€' },
  { id: 'clinical', name: 'å®Ÿç¿’å¯¾ç­–', icon: 'ğŸ¥' },
];

// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
function formatDate(date: Date | undefined): string {
  if (!date) return '';
  return new Date(date).toLocaleDateString('ja-JP');
}
---

<BaseLayout 
  title="æ•™æãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ¯”è¼ƒ"
  description="ç†å­¦ç™‚æ³•å£«å›½å®¶è©¦é¨“å¯¾ç­–ã«å½¹ç«‹ã¤æ•™æãƒ»å‚è€ƒæ›¸ãƒ»ã‚¢ãƒ—ãƒªã®æ¯”è¼ƒè¨˜äº‹ä¸€è¦§ã€‚PTå­¦ç”Ÿã«ã‚ˆã‚‹æ­£ç›´ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã€‚"
>
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ -->
  <section class="page-hero">
    <div class="container">
      <p class="page-hero__label">Materials</p>
      <h1 class="page-hero__title">æ•™æãƒ»ã‚µãƒ¼ãƒ“ã‚¹æ¯”è¼ƒ</h1>
      <p class="page-hero__subtitle">PTå­¦ç”Ÿã«ã‚ˆã‚‹æ­£ç›´ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã§æ•™æé¸ã³ã‚’ã‚µãƒãƒ¼ãƒˆ</p>
    </div>
  </section>

  <!-- æ³¨æ„æ›¸ã -->
  <section class="section section--alt">
    <div class="container container--narrow">
      <div class="notice-card">
        <p class="notice-card__icon">ğŸ“¢</p>
        <div>
          <p class="notice-card__title">åºƒå‘Šã«ã¤ã„ã¦</p>
          <p class="notice-card__text">
            æœ¬ã‚µã‚¤ãƒˆã®ä¸€éƒ¨è¨˜äº‹ã«ã¯ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
            ãƒªãƒ³ã‚¯çµŒç”±ã§å•†å“ã‚’è³¼å…¥ã—ãŸå ´åˆã€ç§ãŸã¡ã¯ç´¹ä»‹æ–™ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
            ãŸã ã—ã€ã“ã‚Œã«ã‚ˆã‚Šèª­è€…ãŒè¿½åŠ æ–™é‡‘ã‚’è² æ‹…ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
          </p>
          <a href="/policy/affiliate-disclosure" class="notice-card__link">è©³ã—ãè¦‹ã‚‹ â†’</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <section class="section">
    <div class="container">
      <div class="category-filter">
        <button class="category-btn active" data-category="all">ã™ã¹ã¦</button>
        {categories.map((cat) => (
          <button class="category-btn" data-category={cat.id}>
            {cat.icon} {cat.name}
          </button>
        ))}
      </div>

      <!-- è¨˜äº‹ä¸€è¦§ -->
      <div class="materials-grid">
        {allMaterials.map((material) => (
          <a href={`/materials/${material.slug}`} class="material-card" data-category={material.data.category}>
            <div class="material-card__header">
              <span class="material-card__category">
                {categories.find(c => c.id === material.data.category)?.icon}
                {categories.find(c => c.id === material.data.category)?.name}
              </span>
              <span class="material-card__date">
                {formatDate(material.data.publishedDate)}
              </span>
            </div>
            <h3 class="material-card__title">{material.data.title}</h3>
            <p class="material-card__description">{material.data.description}</p>
            <span class="material-card__link">è©³ã—ãè¦‹ã‚‹ â†’</span>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta-section">
    <div class="container cta-section__content">
      <h2 class="cta-section__title">ã‚‚ã£ã¨åŠ¹ç‡çš„ã«å­¦ç¿’ã—ãŸã„ï¼Ÿ</h2>
      <p class="cta-section__subtitle">
        æœˆé¡500å††ã§å­¦ç¿’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚„è³ªå•ç’°å¢ƒãŒæ‰‹ã«å…¥ã‚Šã¾ã™
      </p>
      <a href="/join" class="btn btn--primary btn--lg">
        ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å‚åŠ ã™ã‚‹
      </a>
    </div>
  </section>
</BaseLayout>

<style>
  /* Page Hero */
  .page-hero {
    background: var(--gradient-hero);
    color: white;
    padding: calc(80px + var(--space-16)) 0 var(--space-16);
    text-align: center;
  }
  
  .page-hero__label {
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    margin-bottom: var(--space-4);
  }
  
  .page-hero__title {
    font-size: var(--text-4xl);
    color: white;
    margin-bottom: var(--space-4);
  }
  
  .page-hero__subtitle {
    font-size: var(--text-xl);
    opacity: 0.9;
  }
  
  /* Container narrow */
  .container--narrow {
    max-width: 800px;
  }
  
  /* Notice Card */
  .notice-card {
    display: flex;
    gap: var(--space-4);
    padding: var(--space-6);
    background: var(--color-bg-white);
    border-radius: var(--radius-xl);
    border-left: 4px solid var(--color-secondary);
    box-shadow: var(--shadow-md);
  }
  
  .notice-card__icon {
    font-size: 2rem;
    flex-shrink: 0;
  }
  
  .notice-card__title {
    font-weight: var(--font-semibold);
    margin-bottom: var(--space-2);
  }
  
  .notice-card__text {
    font-size: var(--text-sm);
    color: var(--color-text-light);
    line-height: 1.8;
    margin-bottom: var(--space-2);
  }
  
  .notice-card__link {
    font-size: var(--text-sm);
    color: var(--color-primary);
    font-weight: var(--font-semibold);
  }
  
  /* Category Filter */
  .category-filter {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-bottom: var(--space-8);
    justify-content: center;
  }
  
  .category-btn {
    padding: var(--space-2) var(--space-4);
    background: var(--color-bg-white);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-full);
    font-family: inherit;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-text-light);
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .category-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
  }
  
  .category-btn.active {
    background: var(--gradient-primary);
    border-color: transparent;
    color: white;
  }
  
  /* Materials Grid */
  .materials-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-6);
  }
  
  @media (max-width: 1024px) {
    .materials-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (max-width: 640px) {
    .materials-grid {
      grid-template-columns: 1fr;
    }
  }
  
  /* Material Card */
  .material-card {
    display: flex;
    flex-direction: column;
    padding: var(--space-6);
    background: var(--color-bg-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
    text-decoration: none;
    color: inherit;
    transition: all var(--transition-normal);
  }
  
  .material-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
  }
  
  .material-card__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-3);
  }
  
  .material-card__category {
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--color-primary);
    background: var(--color-primary-bg);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-md);
  }
  
  .material-card__date {
    font-size: var(--text-xs);
    color: var(--color-text-muted);
  }
  
  .material-card__title {
    font-size: var(--text-lg);
    margin-bottom: var(--space-2);
    line-height: 1.4;
  }
  
  .material-card__description {
    font-size: var(--text-sm);
    color: var(--color-text-light);
    flex: 1;
    margin-bottom: var(--space-4);
    line-height: 1.7;
  }
  
  .material-card__link {
    font-size: var(--text-sm);
    color: var(--color-primary);
    font-weight: var(--font-semibold);
  }
  
  .material-card[data-hidden="true"] {
    display: none;
  }
</style>

<script>
  const filterBtns = document.querySelectorAll('.category-btn');
  const cards = document.querySelectorAll('.material-card');
  
  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');
      
      filterBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      cards.forEach(card => {
        const cardCategory = card.getAttribute('data-category');
        if (category === 'all' || cardCategory === category) {
          card.removeAttribute('data-hidden');
        } else {
          card.setAttribute('data-hidden', 'true');
        }
      });
    });
  });
</script>
